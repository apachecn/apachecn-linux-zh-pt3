# 9.使用 RPi GPIO 编程

在上一章中，我们介绍了类 Unix 平台上的高级编程语言。我们学习了用 C 和 C++用 GCC 编译器编写程序。我们还学习了如何用 Python 3 编程语言编写和执行程序。

继续我们在上一章停止的地方，在这一章，我们将探索用 RPi 和 Python 3 进行 GPIO 编程。以下是我们将在本章探讨的主题列表:

*   GPIO 引脚

*   使用 GPIO 编程

在这一章之后，我们将会对 GPIO 编程和使用 Raspberry Pi 的基本电子元件感到很舒服。

## 通用输入/输出引脚

RPi 板有通用输入/输出接头引脚。所有版本的 RPi 板都有此功能。这个特性使单板计算机有别于其他小型计算机。GPIO 引脚使 SBC 能够直接与低级电子元件和各种数据传输总线接口。

我在本章中使用了一个 8 GB 内存的 RPi 4 B 板。这是 RPi 系列中最新的主板。通过运行以下特定于 RPi 操作系统的命令，我们可以看到任何 RPi 板上引脚的含义:

```sh
pinout

```

它将向我们展示电路板的布局，如图 [9-1](#Fig1) 所示。

![../images/503786_1_En_9_Chapter/503786_1_En_9_Fig1_HTML.jpg](../images/503786_1_En_9_Chapter/503786_1_En_9_Fig1_HTML.jpg)

图 9-1

RPi 4 B 的电路板布局

在图的左上部分，我们可以看到 40 个 GPIO 引脚。一些早期型号的 RPi 有 26 个引脚。但是早就停产了，这里就不讨论了。我们将在本章演示的程序与所有的 Pi 模型都是兼容的。图 [9-1](#Fig1) 是命令行上显示的输出的第一部分。如果我们向下滚动，我们可以看到更多。输出的最后部分向我们展示了如图 [9-2](#Fig2) 所示的引脚的含义。

![../images/503786_1_En_9_Chapter/503786_1_En_9_Fig2_HTML.jpg](../images/503786_1_En_9_Chapter/503786_1_En_9_Fig2_HTML.jpg)

图 9-2

RPi 4 B 引脚排列

该输出向我们显示了电源引脚(5V、3V3 和 GND)和数字 IO 引脚。GND 代表地，3V3 代表 3.3 伏。我们可以看到输出中显示了两种编号方案。物理引脚号(也称为板引脚号)在括号内，BCM 名称在外面。为了方便起见，我们将在编写的程序中使用电路板(物理)引脚编号。

我们可以通过比较两个图 [9-1](#Fig1) 和 [9-2](#Fig2) 来了解销的方向。这两个图中的销都用颜色标记。

现在，拿一个 LED、一个电阻器和几根跨接电缆，准备如图 [9-3](#Fig3) 所示的电路。

![../images/503786_1_En_9_Chapter/503786_1_En_9_Fig3_HTML.jpg](../images/503786_1_En_9_Chapter/503786_1_En_9_Fig3_HTML.jpg)

图 9-3

简单的 LED 电路

只要 RPi 板打开，LED 就会一直亮着。这是因为我们将 LED 的阳极(较长的引脚)连接到 3V3 引脚，阴极通过 470 欧姆的电阻连接到 GND 引脚。这是我们能用它制作的最简单的 LED 电路。你可以试着把 LED 的阳极接到 5V 的管脚上，它会发出更多的光。我们选择了阻值合适的电阻，这样就不会烧坏 LED。在下一节中，我们将看到如何用 GPIO 编写程序。

## 使用 GPIO 编程

在本节中，我们将看到带有发光二极管和按钮的简单电路。为此，我们将使用 Python 3 GPIO 库。它预装在 RPi 操作系统中。如果没有预先安装，请使用以下命令进行安装:

```sh
sudo apt-get install python3-rpi.gpio -y

```

准备如图 [9-4](#Fig4) 所示的电路。

![../images/503786_1_En_9_Chapter/503786_1_En_9_Fig4_HTML.jpg](../images/503786_1_En_9_Chapter/503786_1_En_9_Fig4_HTML.jpg)

图 9-4

可编程 LED 电路

我们将 LED 的阳极连接到图 [9-2](#Fig2) 中物理编号为 8 的引脚。这是我们对早期赛道的唯一改变。查看列表 [9-1](#PC3) 。

```sh
from time import sleep
import RPi.GPIO as GPIO

GPIO.setmode(GPIO.BOARD)
GPIO.setwarnings(False)
GPIO.setup(8, GPIO.OUT, initial=GPIO.LOW)

while True:
    GPIO.output(8, GPIO.HIGH)
    sleep(1)
    GPIO.output(8, GPIO.LOW)
    sleep(1)

Listing 9-1LED_Blink.py

```

让我们详细讨论一下。前两行导入所需的库。然后，我们用语句`GPIO.setmode()`指示 RPi 板使用板(如前所述，也称为物理)引脚编号。然后我们禁用警告。我们使用函数`GPIO.setup()`将电路板引脚 8 设置为输出模式。我们也将其初始状态设置为`LOW`。然后，在一个无限循环中，我们交替发送`HIGH`和`LOW`信号到引脚 8。对函数`sleep()`的调用在语句之间增加了 1 秒的间隔。当 8 脚为`HIGH`时，LED 亮；当第 8 脚为`LOW`时，LED 熄灭。使用以下命令运行脚本:

```sh
python3 LED_Blink.py

```

LED 将开始闪烁。要终止程序，请按键盘上的 Ctrl+C。

这是基本的 GPIO 编程。如果我们使用试验板将多个 led 连接到数字 GPIO 引脚，我们可以创造性地利用这一点来创建各种模式的闪烁 led。

## 摘要

在本章中，我们继续了 Python 3 编程的旅程，并研究了一个使 LED 闪烁的程序。我们还学习了如何用一个 LED 和一个电阻构建一个基本电路。Raspberry Pi 通过它的 GPIO 编程提供了更多的东西。您可以在方便的时候进一步探索这个庞大的主题。

在下一章中，我们将详细研究 RPi 操作系统的 GUI。我们还将详细了解如何为 RPi OS 安装各种桌面环境。